<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Show</title>
    <link rel="stylesheet" href="css/detalhes.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
   <!-- DIV NECESSARIA PARA FUNCIONAMENTO DO PLUGIN, NAO APAGAR!-->
     <div vw class="enabled">
    <div vw-access-button class="active"></div>
    <div vw-plugin-wrapper>
      <div class="vw-plugin-top-wrapper"></div>
    </div>
  </div>
  <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
  <script>
    new window.VLibras.Widget('https://vlibras.gov.br/app');
  </script>
<!-- DIV NECESSARIA PARA FUNCIONAMENTO DO PLUGIN, NAO APAGAR!-->


    <header class="header">
        <a href="/" class="logo-link">
            <img src="img/LOGO CORDAS SOLTAS SITE.png" alt="Logo Cordas Soltas" class="logo">
        </a>
        <nav class="nav-icons">
            <button class="menu-toggle" id="menu-toggle" aria-label="Abrir menu">&#9776;</button>
            <a href="/perfil" id="account-link" class="account-icon" aria-label="Conta">&#128100;</a>
            <a href="#" class="cart-icon" aria-label="Carrinho">&#128722;</a>
        </nav>
    </header>

    <main class="main-content">
        <aside class="banner-side left">
            <img src="https://i.pinimg.com/736x/ac/b3/72/acb3728c928849aa524c05f41efa1773.jpg" alt="An√∫ncio Lateral Esquerdo">
        </aside>

        <section class="details-and-back-container">
            <a href="/" class="back-link">&larr; Voltar para Eventos</a>
            
            <section id="show-details-container" class="show-details-container">
                <p>Carregando detalhes do show...</p>
            </section>

        </section>

        <aside class="banner-side right">
            <img src="https://st2.depositphotos.com/3802717/48785/v/1600/depositphotos_487853802-stock-illustration-live-rock-music-show-concert.jpg" alt="An√∫ncio Lateral Direito">
        </aside>
    </main>

    <section id="menu-overlay" class="menu-overlay"></section>
     <aside id="sidebar-menu" class="sidebar">
        <button id="close-menu-btn" class="close-menu-btn" aria-label="Fechar menu">&times;</button>
        <ul class="sidebar-links">
            <li><a href="/">In√≠cio</a></li>
            <li><a href="/sobre">Sobre</a></li>
            <li><a href="/seletivas">Concurso</a></li>
            <li><a href="/luthbox">Luthbox</a></li>
            <li><a href="/mensalidade">Mensalidade</a></li>
        </ul>
    </aside>
    <section id="menu-overlay" class="menu-overlay"></section>

    <script src="/shows"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('show-details-container');
            const params = new URLSearchParams(window.location.search);
            const showId = params.get('id');

            // Procura o show no array 'shows'
            const foundShow = shows.find(show => show.id === showId);

            if (foundShow) {
                // SALVA O SHOW ENCONTRADO NO LOCALSTORAGE
                localStorage.setItem('selectedShow', JSON.stringify(foundShow));

                // Formata os pre√ßos para exibi√ß√£o
                const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                // Monta o HTML din√¢mico do show
                container.innerHTML = `
                    <section class="show-image-wrapper">
                        <img src="${foundShow.image}" alt="${foundShow.title}" class="show-image">
                    </section>
                    <section class="show-info-wrapper">
                        <section class="show-info">
                            <h1>${foundShow.title}</h1>
                            <p>üìÖ ${foundShow.date}</p>
                            <p>üìç ${foundShow.location}</p>
                        </section>
                        <section class="purchase-section">
                            <section class="ticket-option">
                                <section class="ticket-name">
                                    <h3>Inteira</h3>
                                    <span class="ticket-count" data-ticket-type="full"></span>
                                    <span class="ticket-price">${formatCurrency(foundShow.priceFull)}</span>
                                </section>
                                <section class="quantity-control">
                                    <button class="quantity-btn minus" data-type="full">-</button>
                                    <input type="number" id="qty-full" value="0" min="0" max="10" readonly>
                                    <button class="quantity-btn plus" data-type="full">+</button>
                                </section>
                            </section>
                            <section class="ticket-option">
                                <section class="ticket-name">
                                    <h3>Meia-Entrada</h3>
                                    <span class="ticket-count" data-ticket-type="half"></span>
                                    <span class="ticket-price">${formatCurrency(foundShow.priceHalf)}</span>
                                </section>
                                <section class="quantity-control">
                                    <button class="quantity-btn minus" data-type="half">-</button>
                                    <input type="number" id="qty-half" value="0" min="0" max="10" readonly>
                                    <button class="quantity-btn plus" data-type="half">+</button>
                                </section>
                            </section>
                            <section class="total-summary">
                                <h3>Total:</h3>
                                <span id="total-value" class="total-price">R$ 0,00</span>
                            </section>
                            <button id="buy-button" class="buy-button">
                                Comprar Ingressos</button>
                            <section id="error-message" class="error-message"></section> </section>
                    </section>
                `;

                //C√ìDIGO PARA GERENCIAR A CONTAGEM E MOSTRAR/OCULTAR NO NOME DO INGRESSO
                const updateTicketCountDisplay = (type, qty) => {
                    const countSpan = document.querySelector(`.ticket-count[data-ticket-type="${type}"]`);
                    const nameH3 = countSpan.previousElementSibling;
                    
                    if (qty > 0) {
                        const ticketLabel = nameH3.textContent.trim().toLowerCase();
                        countSpan.textContent = `${qty}x ${ticketLabel}`;
                        countSpan.classList.add('visible');
                    } else {
                        countSpan.textContent = '';
                        countSpan.classList.remove('visible');
                    }
                };

                // Adiciona listeners para atualizar a contagem no display do nome do ingresso
                document.querySelectorAll('.quantity-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const type = event.target.dataset.type;
                        const input = document.getElementById(`qty-${type}`);
                        
                        // O script `detalhes.js` cuidar√° da atualiza√ß√£o do valor do input,
                        setTimeout(() => {
                            const newQty = parseInt(input.value);
                            updateTicketCountDisplay(type, newQty);
                        }, 50); // Pequeno atraso para garantir que 'detalhes.js' j√° atualizou o valor
                    });
                });
                
            } else {
                container.innerHTML = '<h2>Show n√£o encontrado</h2><p>O evento que voc√™ est√° procurando n√£o foi localizado. Por favor, volte para a p√°gina inicial.</p>';
            }
        });
    </script>
    
    <script src="js/shows.js"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('show-details-container');
            const params = new URLSearchParams(window.location.search);
            const showId = params.get('id');

            // Procura o show no array 'shows' 
            const foundShow = shows.find(show => show.id === showId);

            if (foundShow) {
        
            } else {
                container.innerHTML = '<h2>Show n√£o encontrado</h2><p>O evento que voc√™ est√° procurando n√£o foi localizado. Por favor, volte para a p√°gina inicial.</p>';
            }
        });
    </script>
    
    <script src="js/detalhes.js"></script> 
    
    <script>
          document.addEventListener('DOMContentLoaded', () => {
            const accountLink = document.getElementById('account-link');
            const sidebarAccountLink = document.getElementById('sidebar-account-link');
            
            const userProfile = localStorage.getItem('userProfile');

            if (userProfile) {
                if (accountLink) {
                    accountLink.href = '/perfil';
                }
                if (sidebarAccountLink) {
                    sidebarAccountLink.href = '/perfil';
                    sidebarAccountLink.textContent = 'Meu Perfil'; 
                }
            } else {
                if (accountLink) {
                    accountLink.href = '/login';
                }
                if (sidebarAccountLink) {
                    sidebarAccountLink.href = '/login';
                    sidebarAccountLink.textContent = 'Conta (Login)';
                }
            }
        });
    </script>

</body>
</html>