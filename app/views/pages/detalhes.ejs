<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalhes do Show</title>
    <link rel="stylesheet" href="css/detalhes.css"> 
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

      <%- include("../partials/header"); %>

    <main class="main-content">
        <aside class="banner-side left">
            <img src="https://via.placeholder.com/150x600?text=ANUNCIO" alt="An√∫ncio Lateral Esquerdo">
        </aside>

        <section class="details-and-back-container">
            <a href="/" class="back-link">&larr; Voltar para Eventos</a>
            
            <section id="show-details-container" class="show-details-container">
                <p>Carregando detalhes do show...</p>
            </section>

        </section>

        <aside class="banner-side right">
            <img src="https://via.placeholder.com/150x600?text=ANUNCIO" alt="An√∫ncio Lateral Direito">
        </aside>
    </main>

      <%- include("../partials/menu"); %>

    <script src="/shows"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('show-details-container');
            const params = new URLSearchParams(window.location.search);
            const showId = params.get('id');

            const foundShow = shows.find(show => show.id === showId);

            if (foundShow) {
                localStorage.setItem('selectedShow', JSON.stringify(foundShow));

                const formatCurrency = (value) => value.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

                container.innerHTML = `
                    <section class="show-image-wrapper">
                        <img src="${foundShow.image}" alt="${foundShow.title}" class="show-image">
                    </section>
                    <section class="show-info-wrapper">
                        <section class="show-info">
                            <h1>${foundShow.title}</h1>
                            <p>üìÖ ${foundShow.date}</p>
                            <p>üìç ${foundShow.location}</p>
                        </section>
                        <section class="purchase-section">
                            <section class="ticket-option">
                                <section class="ticket-name">
                                    <h3>Inteira</h3>
                                    <span class="ticket-count" data-ticket-type="full"></span>
                                    <span class="ticket-price">${formatCurrency(foundShow.priceFull)}</span>
                                </section>
                                <section class="quantity-control">
                                    <button class="quantity-btn minus" data-type="full">-</button>
                                    <input type="number" id="qty-full" value="0" min="0" max="10" readonly>
                                    <button class="quantity-btn plus" data-type="full">+</button>
                                </section>
                            </section>
                            <section class="ticket-option">
                                <section class="ticket-name">
                                    <h3>Meia-Entrada</h3>
                                    <span class="ticket-count" data-ticket-type="half"></span>
                                    <span class="ticket-price">${formatCurrency(foundShow.priceHalf)}</span>
                                </section>
                                <section class="quantity-control">
                                    <button class="quantity-btn minus" data-type="half">-</button>
                                    <input type="number" id="qty-half" value="0" min="0" max="10" readonly>
                                    <button class="quantity-btn plus" data-type="half">+</button>
                                </section>
                            </section>
                            <section class="total-summary">
                                <h3>Total:</h3>
                                <span id="total-value" class="total-price">R$ 0,00</span>
                            </section>
                            <button id="buy-button" class="buy-button">
                                Comprar Ingressos</button>
                            <section id="error-message" class="error-message"></section> </section>
                    </section>
                `;

                const updateTicketCountDisplay = (type, qty) => {
                    const countSpan = document.querySelector(`.ticket-count[data-ticket-type="${type}"]`);
                    const nameH3 = countSpan.previousElementSibling;
                    
                    if (qty > 0) {
                        const ticketLabel = nameH3.textContent.trim().toLowerCase();
                        countSpan.textContent = `${qty}x ${ticketLabel}`;
                        countSpan.classList.add('visible');
                    } else {
                        countSpan.textContent = '';
                        countSpan.classList.remove('visible');
                    }
                };

                document.querySelectorAll('.quantity-btn').forEach(button => {
                    button.addEventListener('click', (event) => {
                        const type = event.target.dataset.type;
                        const input = document.getElementById(`qty-${type}`);
                        
                        setTimeout(() => {
                            const newQty = parseInt(input.value);
                            updateTicketCountDisplay(type, newQty);
                        }, 50);
                    });
                });
                
            } else {
                container.innerHTML = '<h2>Show n√£o encontrado</h2><p>O evento que voc√™ est√° procurando n√£o foi localizado. Por favor, volte para a p√°gina inicial.</p>';
            }
        });
    </script>
    
    <script src="js/shows.js"></script> 

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('show-details-container');
            const params = new URLSearchParams(window.location.search);
            const showId = params.get('id');

            const foundShow = shows.find(show => show.id === showId);

            if (foundShow) {
            } else {
                container.innerHTML = '<h2>Show n√£o encontrado</h2><p>O evento que voc√™ est√° procurando n√£o foi localizado. Por favor, volte para a p√°gina inicial.</p>';
            }
        });
    </script>
    
    <script src="js/detalhes.js"></script> 
    
</body>
</html>